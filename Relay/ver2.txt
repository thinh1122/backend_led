HÆ¯á»šNG DáºªN Ná»I DÃ‚Y SMART PLUG - VERSION 2 (Cáº¢I TIáº¾N)
========================================================

âš ï¸ THAY Äá»”I CHÃNH SO Vá»šI VERSION 1:
- Äáº·t ACS712 SAU Relay (thay vÃ¬ trÆ°á»›c) Ä‘á»ƒ Ä‘o chÃ­nh xÃ¡c hÆ¡n
- Chá»‰ Ä‘o dÃ²ng Ä‘iá»‡n khi Relay Báº¬T, trÃ¡nh nhiá»…u khi Táº®T
- ThÃªm hÆ°á»›ng dáº«n calibration (hiá»‡u chá»‰nh) cáº£m biáº¿n

========================================================

MÃ´ hÃ¬nh cá»§a báº¡n gá»“m 2 pháº§n Ä‘iá»‡n Ã¡p riÃªng biá»‡t:

âœ… Pháº§n 220V AC (Äiá»‡n lÆ°á»›i - Cáº¨N THáº¬N): Cháº¡y tá»« phÃ­ch cáº¯m Ä‘áº¿n á»• cáº¯m qua Relay vÃ  cáº£m biáº¿n dÃ²ng.
âœ… Pháº§n 5V DC (Äiá»‡n Ä‘iá»u khiá»ƒn): NuÃ´i ESP32, Relay Module, cáº£m biáº¿n Ä‘o dÃ²ng.

========================================================
BÆ¯á»šC 1: Chuáº©n bá»‹ dÃ¢y nguá»“n (Pháº§n 220V)
========================================================

TÆ°á»Ÿng tÆ°á»£ng dÃ¢y phÃ­ch cáº¯m nguá»“n cá»§a báº¡n cÃ³ 2 sá»£i: DÃ¢y Lá»­a (L) vÃ  DÃ¢y Nguá»™i (N).

1. Cáº¥p Ä‘iá»‡n cho Hi-Link (Äá»ƒ biáº¿n 220V thÃ nh 5V nuÃ´i máº¡ch):

   Ná»‘i DÃ¢y Lá»­a (L) vÃ  DÃ¢y Nguá»™i (N) tá»« phÃ­ch cáº¯m vÃ o 2 chÃ¢n Ä‘áº§u vÃ o (Input AC) cá»§a cá»¥c Hi-Link.
   (LÃºc nÃ y cá»¥c Hi-Link sáº½ cÃ³ Ä‘iá»‡n).

2. Ná»‘i dÃ¢y ra á»” cáº¯m thÃ´ng minh (Load):

   ğŸ”¥ SÆ  Äá»’ NÃ‚NG Cáº¤P (Ver 2):
   
   DÃ¢y Lá»­a (L) tá»« phÃ­ch cáº¯m -> Ná»‘i vÃ o chÃ¢n COM (ChÃ¢n giá»¯a) cá»§a Relay.
   Tá»« chÃ¢n NO (ThÆ°á»ng má»Ÿ) cá»§a Relay -> Ná»‘i sang Cá»c 1 cá»§a Module ACS712.
   Tá»« Cá»c 2 cá»§a ACS712 -> Ná»‘i ra Lá»— thá»© nháº¥t cá»§a cÃ¡i á»” cáº¯m cÃ¡i.
   DÃ¢y Nguá»™i (N) tá»« phÃ­ch cáº¯m -> Ná»‘i tháº³ng vÃ o Lá»— thá»© hai cá»§a cÃ¡i á»” cáº¯m cÃ¡i.

   âœ¨ TÃ³m táº¯t máº¡ch 220V Ver 2: Lá»­a -> Relay (COM->NO) -> ACS712 -> á»” Cáº¯m -> Nguá»™i.

   ğŸ“Š So sÃ¡nh vá»›i Ver 1:
   - Ver 1: Lá»­a -> ACS712 -> Relay -> á»” Cáº¯m -> Nguá»™i
   - Ver 2: Lá»­a -> Relay -> ACS712 -> á»” Cáº¯m -> Nguá»™i (Tá»T HÆ N)

   ğŸ’¡ LÃ½ do thay Ä‘á»•i:
   - Khi Relay Táº®T: ACS712 khÃ´ng cÃ³ dÃ²ng Ä‘iá»‡n Ä‘i qua -> Ä‘á»c 0A (chÃ­nh xÃ¡c)
   - Khi Relay Báº¬T: ACS712 Ä‘o dÃ²ng Ä‘iá»‡n thá»±c cá»§a thiáº¿t bá»‹
   - TrÃ¡nh nhiá»…u vÃ  Ä‘á»c sai khi Relay á»Ÿ tráº¡ng thÃ¡i Táº®T

========================================================
BÆ¯á»šC 2: Ná»‘i dÃ¢y Ä‘iá»u khiá»ƒn (Pháº§n 5V & TÃ­n hiá»‡u)
========================================================

Pháº§n nÃ y láº¥y Ä‘iá»‡n tá»« Ä‘áº§u ra cá»§a cá»¥c Hi-Link.

1. Chia nguá»“n 5V (Tá»« Ä‘áº§u ra Hi-Link):

   ChÃ¢n +Vo (5V) cá»§a Hi-Link: Ná»‘i vÃ o chÃ¢n 5V cá»§a ESP32, chÃ¢n VCC cá»§a Relay, chÃ¢n VCC cá»§a ACS712.
   ChÃ¢n -Vo (GND) cá»§a Hi-Link: Ná»‘i vÃ o chÃ¢n GND cá»§a ESP32, chÃ¢n GND cá»§a Relay, chÃ¢n GND cá»§a ACS712.
   (LÆ°u Ã½: Táº¥t cáº£ cÃ¡c chÃ¢n GND pháº£i ná»‘i chung vá»›i nhau).

2. Ná»‘i NÃºt nháº¥n (NÃºt cÆ¡):

   NÃºt thÆ°á»ng cÃ³ 2 chÃ¢n (hoáº·c 4 chÃ¢n nhÆ°ng lÃ  2 cáº·p).
   ChÃ¢n thá»© nháº¥t: Ná»‘i vÃ o dÃ¢y GND (chung vá»›i Ä‘Ã¡m GND á»Ÿ trÃªn).
   ChÃ¢n thá»© hai: Ná»‘i vÃ o chÃ¢n GPIO 9 trÃªn ESP32 (Theo code).

3. Ná»‘i tÃ­n hiá»‡u Relay:

   ChÃ¢n IN cá»§a Relay Module -> Ná»‘i vÃ o chÃ¢n GPIO 8 trÃªn ESP32.

4. Ná»‘i tÃ­n hiá»‡u cáº£m biáº¿n dÃ²ng ACS712:

   ChÃ¢n OUT cá»§a ACS712 -> Ná»‘i vÃ o chÃ¢n GPIO 0 (ADC) trÃªn ESP32.

========================================================
Tá»”NG Há»¢P KIá»‚M TRA (CHECKLIST Ver 2)
========================================================

Báº¡n dÃ² láº¡i dÃ¢y 1 láº§n ná»¯a trÆ°á»›c khi cáº¯m Ä‘iá»‡n:

âœ… Relay:
   - VCC -> 5V
   - GND -> GND
   - IN -> GPIO 8
   - COM (220V) -> Ná»‘i vá»›i DÃ¢y Lá»­a tá»« phÃ­ch cáº¯m
   - NO (220V) -> Ná»‘i vÃ o Cá»c 1 ACS712 â­ (THAY Äá»”I)

âœ… NÃºt nháº¥n:
   - Má»™t chÃ¢n -> GND
   - Má»™t chÃ¢n -> GPIO 9

âœ… ACS712:
   - VCC -> 5V
   - GND -> GND
   - OUT -> GPIO 0
   - Cá»c 1 (220V) -> Ná»‘i vá»›i chÃ¢n NO cá»§a Relay â­ (THAY Äá»”I)
   - Cá»c 2 (220V) -> Ná»‘i ra á»” cáº¯m

âœ… Hi-Link:
   - Input AC -> Lá»­a (L) vÃ  Nguá»™i (N) tá»« phÃ­ch cáº¯m
   - +Vo (5V) -> Chia cho ESP32, Relay, ACS712
   - -Vo (GND) -> Ná»‘i chung táº¥t cáº£ GND

========================================================
BÆ¯á»šC 3: HIá»†U CHá»ˆNH Cáº¢M BIáº¾N (CALIBRATION)
========================================================

Sau khi ná»‘i dÃ¢y xong, báº¡n cáº§n hiá»‡u chá»‰nh ACS712 Ä‘á»ƒ Ä‘o chÃ­nh xÃ¡c:

1. XÃ¡c Ä‘á»‹nh model ACS712 cá»§a báº¡n:
   - ACS712-5A: Äo tá»‘i Ä‘a 5A (Ä‘á»™ nháº¡y 185 mV/A)
   - ACS712-20A: Äo tá»‘i Ä‘a 20A (Ä‘á»™ nháº¡y 100 mV/A)
   - ACS712-30A: Äo tá»‘i Ä‘a 30A (Ä‘á»™ nháº¡y 66 mV/A)

2. Äo giÃ¡ trá»‹ OFFSET (KhÃ´ng táº£i):
   - Cáº¯m Ä‘iá»‡n nhÆ°ng KHÃ”NG cáº¯m thiáº¿t bá»‹ vÃ o á»• cáº¯m
   - Báº­t Relay ON
   - Äá»c giÃ¡ trá»‹ ADC tá»« ESP32 -> ÄÃ¢y lÃ  giÃ¡ trá»‹ OFFSET (thÆ°á»ng ~512 vá»›i ADC 10-bit, ~2048 vá»›i ADC 12-bit)
   - LÆ°u láº¡i giÃ¡ trá»‹ nÃ y Ä‘á»ƒ trá»« Ä‘i trong code

3. Kiá»ƒm tra vá»›i táº£i chuáº©n:
   - Cáº¯m bÃ³ng Ä‘Ã¨n 60W (hoáº·c thiáº¿t bá»‹ biáº¿t cÃ´ng suáº¥t)
   - TÃ­nh dÃ²ng Ä‘iá»‡n lÃ½ thuyáº¿t: I = P/V = 60W/220V â‰ˆ 0.27A
   - So sÃ¡nh vá»›i giÃ¡ trá»‹ Ä‘o Ä‘Æ°á»£c
   - Äiá»u chá»‰nh cÃ´ng thá»©c trong code náº¿u sai lá»‡ch

4. CÃ´ng thá»©c tÃ­nh trong code ESP32:
   ```
   float voltage = (adc_value * 3.3) / 4095.0;  // ESP32-C3 dÃ¹ng ADC 12-bit
   float current = (voltage - offset_voltage) / sensitivity;
   float power = current * 220.0;  // CÃ´ng suáº¥t (W)
   ```

   Trong Ä‘Ã³:
   - offset_voltage: Äiá»‡n Ã¡p khi khÃ´ng cÃ³ táº£i (~1.65V cho nguá»“n 3.3V)
   - sensitivity: Äá»™ nháº¡y theo model (VD: 0.1 V/A cho ACS712-20A)

========================================================
LÆ¯U Ã AN TOÃ€N âš ï¸
========================================================

1. âš¡ Khi test, nhá»› bá»c bÄƒng dÃ­nh Ä‘iá»‡n ká»¹ cÃ¡c má»‘i ná»‘i 220V.
2. ğŸš« Äá»«ng cháº¡m tay vÃ o board máº¡ch khi Ä‘ang cáº¯m phÃ­ch Ä‘iá»‡n.
3. ğŸ”Œ Ngáº¯t nguá»“n 220V trÆ°á»›c khi sá»­a dÃ¢y hoáº·c kiá»ƒm tra máº¡ch.
4. ğŸ§° DÃ¹ng Ä‘á»“ng há»“ váº¡n nÄƒng Ä‘á»ƒ kiá»ƒm tra Ä‘iá»‡n Ã¡p trÆ°á»›c khi cáº¯m ESP32.
5. ğŸ”¥ Kiá»ƒm tra relay cÃ³ phÃ¡t nhiá»‡t báº¥t thÆ°á»ng khÃ´ng (náº¿u cÃ³ lÃ  dÃ¢y ná»‘i lá»ng).
6. ğŸ“ Äáº£m báº£o khoáº£ng cÃ¡ch cÃ¡ch Ä‘iá»‡n giá»¯a pháº§n 220V vÃ  pháº§n 5V.

========================================================
SO SÃNH Æ¯U NHÆ¯á»¢C ÄIá»‚M
========================================================

ğŸ“Š Version 1 (ACS712 trÆ°á»›c Relay):
   âŒ NhÆ°á»£c Ä‘iá»ƒm:
      - Äá»c dÃ²ng Ä‘iá»‡n ngay cáº£ khi Relay Táº®T (cÃ³ thá»ƒ bá»‹ nhiá»…u)
      - KÃ©m chÃ­nh xÃ¡c khi Relay Táº®T
   âœ… Æ¯u Ä‘iá»ƒm:
      - ÄÆ¡n giáº£n hÆ¡n má»™t chÃºt

ğŸ“Š Version 2 (ACS712 sau Relay) - KHUYÃŠN DÃ™NG:
   âœ… Æ¯u Ä‘iá»ƒm:
      - Chá»‰ Ä‘o dÃ²ng Ä‘iá»‡n khi cÃ³ táº£i THáº¬T (Relay Báº¬T)
      - ChÃ­nh xÃ¡c hÆ¡n, Ã­t nhiá»…u hÆ¡n
      - Dá»… dÃ ng calibration
      - Äá»c 0A khi Relay Táº®T (logic Ä‘Ãºng)
   âŒ NhÆ°á»£c Ä‘iá»ƒm:
      - KhÃ´ng cÃ³ (Ä‘Ã¢y lÃ  cÃ¡ch ná»‘i chuáº©n)

========================================================
Káº¾T LUáº¬N
========================================================

âœ¨ Version 2 Ä‘o ÄÆ¯á»¢C vÃ  CHUáº¨N HÆ N Version 1.
âœ¨ Nhá»› thá»±c hiá»‡n calibration Ä‘á»ƒ cÃ³ káº¿t quáº£ chÃ­nh xÃ¡c nháº¥t.
âœ¨ LuÃ´n Æ°u tiÃªn an toÃ n khi lÃ m viá»‡c vá»›i Ä‘iá»‡n 220V.

ChÃºc báº¡n thÃ nh cÃ´ng! ğŸš€
